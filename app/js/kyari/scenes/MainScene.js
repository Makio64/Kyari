var MainScene,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

MainScene = (function(_super) {
  __extends(MainScene, _super);

  function MainScene() {
    this.onWheelsLoad = __bind(this.onWheelsLoad, this);
    this.onWaterLoad = __bind(this.onWaterLoad, this);
    this.onCrystalLoad = __bind(this.onCrystalLoad, this);
    this.onBaseLoad = __bind(this.onBaseLoad, this);
    this.onEyeLoad = __bind(this.onEyeLoad, this);
    this.onFaceLoad = __bind(this.onFaceLoad, this);
    this.onDiamondLoad = __bind(this.onDiamondLoad, this);
    var loader;
    this.time = 0;
    this.container = new THREE.Object3D();
    this.container.position.y -= 10;
    Stage3d.add(this.container);
    this.ambientLight = new THREE.AmbientLight(0x222222);
    Stage3d.add(this.ambientLight);
    this.cameraLight = new THREE.PointLight(0xffffff, 1, 400);
    this.cameraLight.position.set(30, 50, 50);
    Stage3d.add(this.cameraLight);
    loader = new THREE.JSONLoader();
    loader.load('./3d/json/baseHD.js', this.onBaseLoad);
    loader = new THREE.JSONLoader();
    loader.load('./3d/json/diamond.js', this.onDiamondLoad);
    loader = new THREE.JSONLoader();
    loader.load('./3d/json/crystal.js', this.onCrystalLoad);
    loader = new THREE.JSONLoader();
    loader.load('./3d/json/waterHD.js', this.onWaterLoad);
    loader = new THREE.JSONLoader();
    loader.load('./3d/json/face.js', this.onFaceLoad);
    loader = new THREE.SceneLoader();
    loader.load('./3d/json/eye.js', this.onEyeLoad);
    loader = new THREE.SceneLoader();
    loader.load('./3d/json/wheels.js', this.onWheelsLoad);
    return;
  }

  MainScene.prototype.onDiamondLoad = function(geometry) {
    var material;
    this.computeGeometry(geometry);
    material = new THREE.MeshBasicMaterial({
      color: 0xffffff
    });
    this.diamond = new THREE.Mesh(geometry, material);
    this.container.add(this.diamond);
  };

  MainScene.prototype.onFaceLoad = function(geometry) {
    var material;
    this.computeGeometry(geometry);
    material = new THREE.MeshBasicMaterial({
      color: 0xffffff,
      wireframe: true
    });
    this.face = new THREE.Mesh(geometry, material);
    this.container.add(this.face);
  };

  MainScene.prototype.onEyeLoad = function(scene) {
    var k, material, o, shader, v, _ref;
    shader = THREE.ShaderLib["normalmap"];
    this.uniforms = THREE.UniformsUtils.clone(shader.uniforms);
    this.uniforms["tNormal"].value = THREE.ImageUtils.loadTexture("./3d/textures/HD/NMAP_eye.png");
    this.uniforms["tSpecular"].value = THREE.ImageUtils.loadTexture("./3d/textures/HD/DISP_eye.png");
    this.uniforms["tDiffuse"].value = THREE.ImageUtils.loadTexture("./3d/textures/HD/TEXT_eye.png");
    this.uniforms["enableDiffuse"].value = 1;
    this.uniforms["enableSpecular"].value = 1;
    this.uniforms["uNormalScale"].value.x = 2;
    this.uniforms["uNormalScale"].value.y = 2;
    material = new THREE.ShaderMaterial({
      fragmentShader: shader.fragmentShader,
      vertexShader: shader.vertexShader,
      uniforms: this.uniforms,
      lights: true,
      transparent: false,
      fog: false,
      color: 0xffffff
    });
    _ref = scene.objects;
    for (k in _ref) {
      v = _ref[k];
      o = v;
      if (o.name === 'paupiereDown_Uv') {
        this.closeDown = o;
      } else if (o.name === 'paupiereUp_Uv') {
        this.closeUp = o;
      } else {
        this.eye = o;
      }
      this.computeGeometry(o.geometry);
      o.material = material;
      this.container.add(o);
    }
  };

  MainScene.prototype.onBaseLoad = function(geometry) {
    var material, shader;
    this.computeGeometry(geometry);
    shader = THREE.ShaderLib["normalmap"];
    this.uniforms = THREE.UniformsUtils.clone(shader.uniforms);
    this.uniforms["tNormal"].value = THREE.ImageUtils.loadTexture("./3d/textures/HD/normalBase2048.png");
    this.uniforms["tSpecular"].value = THREE.ImageUtils.loadTexture("./3d/textures/HD/specularBase2048.png");
    this.uniforms["tDiffuse"].value = THREE.ImageUtils.loadTexture("./3d/textures/HD/base1024.png");
    this.uniforms["enableDiffuse"].value = 1;
    this.uniforms["enableSpecular"].value = 1;
    this.uniforms["uNormalScale"].value.x = 2;
    this.uniforms["uNormalScale"].value.y = 2;
    material = new THREE.ShaderMaterial({
      fragmentShader: shader.fragmentShader,
      vertexShader: shader.vertexShader,
      uniforms: this.uniforms,
      lights: true,
      transparent: false,
      fog: false,
      color: 0xffffff
    });
    this.mesh = new THREE.Mesh(geometry, material);
    this.container.add(this.mesh);
  };

  MainScene.prototype.onCrystalLoad = function(geometry) {
    var material;
    this.computeGeometry(geometry);
    this.crystalUniforms = {
      "tDiffuse": {
        type: "t",
        value: THREE.ImageUtils.loadTexture("./3d/textures/HD/crystal.jpg")
      },
      "uGlobalTime": {
        type: "f",
        value: 0.0
      },
      "uOpacity": {
        type: "f",
        value: .5
      }
    };
    material = new THREE.ShaderMaterial({
      fragmentShader: ["uniform sampler2D tDiffuse;", "uniform float uGlobalTime;", "uniform float uOpacity;", "varying vec2 vUv;", "varying vec3 vPos;", "void main() {", "float ratio = vPos.x - .5;", "vec4 texture = texture2D( tDiffuse, vUv +cos(ratio-uGlobalTime*.04)*.4);", "float color = cos(ratio-uGlobalTime*.04)*.5;", "gl_FragColor = vec4( texture.rgb + color, uOpacity);", "}"].join("\n"),
      vertexShader: ["uniform float uGlobalTime;", "varying vec2 vUv;", "varying vec3 vPos;", "void main() {", "vPos = position;", "vUv = uv;", "gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );", "}"].join('\n'),
      uniforms: this.crystalUniforms,
      lights: false,
      transparent: true,
      fog: false,
      color: 0xffffff
    });
    this.crystal = new THREE.Mesh(geometry, material);
    this.container.add(this.crystal);
  };

  MainScene.prototype.onWaterLoad = function(geometry) {
    var material;
    this.computeGeometry(geometry);
    this.waterUniforms = {
      "tDiffuse": {
        type: "t",
        value: THREE.ImageUtils.loadTexture("./3d/textures/HD/water.jpg")
      },
      "uGlobalTime": {
        type: "f",
        value: 0.0
      },
      "amplitude": {
        type: "f",
        value: .8
      }
    };
    material = new THREE.ShaderMaterial({
      fragmentShader: ["uniform sampler2D tDiffuse;", "uniform float uGlobalTime;", "varying vec2 vUv;", "varying vec3 vPos;", "void main() {", "float ratio = -vPos.y;", "float alpha = min(vPos.y/5.0,.15);", "vec4 texture = texture2D( tDiffuse, vUv +cos(ratio-uGlobalTime*.01)*.3);", "float color = cos(ratio-uGlobalTime*.04)*.35;", "gl_FragColor = vec4( texture.rgb + color, alpha);", "}"].join("\n"),
      vertexShader: ["uniform float uGlobalTime;", "uniform float amplitude;", "varying vec3 vNormal;", "varying vec2 vUv;", "varying vec3 vPos;", "void main() {", "vNormal = normal;", "vUv = uv;", "vec3 newPosition = position + normal * vec3(cos(uGlobalTime/70.0+position.y*.4) * amplitude);", "vPos = newPosition;", "gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );", "}"].join('\n'),
      uniforms: this.waterUniforms,
      lights: false,
      transparent: true,
      fog: false,
      color: 0xffffff
    });
    this.water = new THREE.Mesh(geometry, material);
    this.container.add(this.water);
  };

  MainScene.prototype.onWheelsLoad = function(scene) {
    var k, material, o, shader, v, _ref;
    shader = THREE.ShaderLib["normalmap"];
    this.uniforms = THREE.UniformsUtils.clone(shader.uniforms);
    this.uniforms["tNormal"].value = THREE.ImageUtils.loadTexture("./3d/textures/HD/130331_NMAP_roues2048.png");
    this.uniforms["tSpecular"].value = THREE.ImageUtils.loadTexture("./3d/textures/HD/130331_DISP_roues2048.png");
    this.uniforms["tDiffuse"].value = THREE.ImageUtils.loadTexture("./3d/textures/HD/130331_TEXT_roues2048_002.png");
    this.uniforms["enableDiffuse"].value = 1;
    this.uniforms["enableSpecular"].value = 1;
    material = new THREE.ShaderMaterial({
      fragmentShader: shader.fragmentShader,
      vertexShader: shader.vertexShader,
      uniforms: this.uniforms,
      lights: true,
      transparent: false,
      fog: false,
      color: 0xffffff
    });
    this.wheelsVertical = [];
    this.wheelsHorizontal = [];
    _ref = scene.objects;
    for (k in _ref) {
      v = _ref[k];
      o = v;
      this.computeGeometry(o.geometry);
      o.material = material;
      this.container.add(o);
      if (/_y_/i.test(k)) {
        this.wheelsVertical.push(o);
      } else {
        this.wheelsHorizontal.push(o);
      }
    }
  };

  MainScene.prototype.computeGeometry = function(geometry) {
    geometry.computeBoundingSphere();
    geometry.computeFaceNormals();
    geometry.computeVertexNormals();
    geometry.computeVertexNormals();
    geometry.computeTangents();
    geometry.computeMorphNormals();
    geometry.verticesNeedUpdate = true;
    geometry.normalsNeedUpdate = true;
  };

  MainScene.prototype.update = function(dt) {
    var w, _i, _j, _len, _len1, _ref, _ref1;
    this.time += dt;
    this.container.rotation.y += 0.005;
    if (this.wheelsVertical) {
      _ref = this.wheelsVertical;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        w = _ref[_i];
        w.rotation.y += 0.003;
      }
      _ref1 = this.wheelsHorizontal;
      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
        w = _ref1[_j];
        w.rotation.x += 0.003;
      }
    }
    if (this.closeDown) {
      this.closeDown.rotation.x = Math.abs(Math.sin(this.time / 1000) * .7);
      this.closeUp.rotation.x = -Math.abs(Math.sin(this.time / 1000) * .7);
    }
    if (this.crystalUniforms) {
      this.crystalUniforms["uGlobalTime"].value += dt / 30;
    }
    if (this.waterUniforms) {
      this.waterUniforms["uGlobalTime"].value += dt / 30;
    }
  };

  return MainScene;

})(Scene);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImt5YXJpL3NjZW5lcy9NYWluU2NlbmUuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUEsU0FBQTtFQUFBOztpU0FBQTs7QUFBQTtBQUVDLDhCQUFBLENBQUE7O0FBQVksRUFBQSxtQkFBQSxHQUFBO0FBRVgsdURBQUEsQ0FBQTtBQUFBLHFEQUFBLENBQUE7QUFBQSx5REFBQSxDQUFBO0FBQUEsbURBQUEsQ0FBQTtBQUFBLGlEQUFBLENBQUE7QUFBQSxtREFBQSxDQUFBO0FBQUEseURBQUEsQ0FBQTtBQUFBLFFBQUEsTUFBQTtBQUFBLElBQUEsSUFBQyxDQUFBLElBQUQsR0FBUSxDQUFSLENBQUE7QUFBQSxJQUVBLElBQUMsQ0FBQSxTQUFELEdBQWlCLElBQUEsS0FBSyxDQUFDLFFBQU4sQ0FBQSxDQUZqQixDQUFBO0FBQUEsSUFHQSxJQUFDLENBQUEsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFwQixJQUF5QixFQUh6QixDQUFBO0FBQUEsSUFJQSxPQUFPLENBQUMsR0FBUixDQUFZLElBQUMsQ0FBQSxTQUFiLENBSkEsQ0FBQTtBQUFBLElBTUEsSUFBQyxDQUFBLFlBQUQsR0FBb0IsSUFBQSxLQUFLLENBQUMsWUFBTixDQUFtQixRQUFuQixDQU5wQixDQUFBO0FBQUEsSUFPQSxPQUFPLENBQUMsR0FBUixDQUFZLElBQUMsQ0FBQSxZQUFiLENBUEEsQ0FBQTtBQUFBLElBUUEsSUFBQyxDQUFBLFdBQUQsR0FBbUIsSUFBQSxLQUFLLENBQUMsVUFBTixDQUFpQixRQUFqQixFQUEyQixDQUEzQixFQUE4QixHQUE5QixDQVJuQixDQUFBO0FBQUEsSUFTQSxJQUFDLENBQUEsV0FBVyxDQUFDLFFBQVEsQ0FBQyxHQUF0QixDQUEyQixFQUEzQixFQUErQixFQUEvQixFQUFtQyxFQUFuQyxDQVRBLENBQUE7QUFBQSxJQVVBLE9BQU8sQ0FBQyxHQUFSLENBQVksSUFBQyxDQUFBLFdBQWIsQ0FWQSxDQUFBO0FBQUEsSUFZQSxNQUFBLEdBQWEsSUFB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TUFBQSxJQUFDLENBQUEsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFwQixHQUF3QixJQUFJLENBQUMsR0FBTCxDQUFTLElBQUksQ0FBQyxHQUFMLENBQVMsSUFBQyxDQUFBLElBQUQsR0FBTSxJQUFmLENBQUEsR0FBcUIsRUFBOUIsQ0FBeEIsQ0FBQTtBQUFBLE1BQ0EsSUFBQyxDQUFBLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBbEIsR0FBc0IsQ0FBQSxJQUFLLENBQUMsR0FBTCxDQUFTLElBQUksQ0FBQyxHQUFMLENBQVMsSUFBQyxDQUFBLElBQUQsR0FBTSxJQUFmLENBQUEsR0FBcUIsRUFBOUIsQ0FEdkIsQ0FERDtLQVBBO0FBV0EsSUFBQSxJQUFHLElBQUMsQ0FBQSxlQUFKO0FBQ0MsTUFBQSxJQUFDLENBQUEsZUFBZ0IsQ0FBQSxhQUFBLENBQWMsQ0FBQyxLQUFoQyxJQUF5QyxFQUFBLEdBQUcsRUFBNUMsQ0FERDtLQVhBO0FBYUEsSUFBQSxJQUFHLElBQUMsQ0FBQSxhQUFKO0FBQ0MsTUFBQSxJQUFDLENBQUEsYUFBYyxDQUFBLGFBQUEsQ0FBYyxDQUFDLEtBQTlCLElBQXVDLEVBQUEsR0FBRyxFQUExQyxDQUREO0tBZE07RUFBQSxDQTNRUCxDQUFBOzttQkFBQTs7R0FGdUIsTUFBeEIsQ0FBQSIsImZpbGUiOiJreWFyaS9zY2VuZXMvTWFpblNjZW5lLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgTWFpblNjZW5lIGV4dGVuZHMgU2NlbmVcblxuXHRjb25zdHJ1Y3RvcjooKS0+XG5cblx0XHRAdGltZSA9IDBcblxuXHRcdEBjb250YWluZXIgPSBuZXcgVEhSRUUuT2JqZWN0M0QoKTtcblx0XHRAY29udGFpbmVyLnBvc2l0aW9uLnkgLT0gMTA7XG5cdFx0U3RhZ2UzZC5hZGQoQGNvbnRhaW5lcilcblxuXHRcdEBhbWJpZW50TGlnaHQgPSBuZXcgVEhSRUUuQW1iaWVudExpZ2h0KDB4MjIyMjIyKVxuXHRcdFN0YWdlM2QuYWRkKEBhbWJpZW50TGlnaHQpXG5cdFx0QGNhbWVyYUxpZ2h0ID0gbmV3IFRIUkVFLlBvaW50TGlnaHQoMHhmZmZmZmYsIDEsIDQwMClcblx0XHRAY2FtZXJhTGlnaHQucG9zaXRpb24uc2V0KCAzMCwgNTAsIDUwICk7XG5cdFx0U3RhZ2UzZC5hZGQoQGNhbWVyYUxpZ2h0KVxuXG5cdFx0bG9hZGVyID0gbmV3IFRIUkVFLkpTT05Mb2FkZXIoKVxuXHRcdGxvYWRlci5sb2FkKCAnLi8zZC9qc29uL2Jhc2VIRC5qcycsIEBvbkJhc2VMb2FkIClcblxuXHRcdGxvYWRlciA9IG5ldyBUSFJFRS5KU09OTG9hZGVyKClcblx0XHRsb2FkZXIubG9hZCggJy4vM2QvanNvbi9kaWFtb25kLmpzJywgQG9uRGlhbW9uZExvYWQgKVxuXG5cdFx0bG9hZGVyID0gbmV3IFRIUkVFLkpTT05Mb2FkZXIoKVxuXHRcdGxvYWRlci5sb2FkKCAnLi8zZC9qc29uL2NyeXN0YWwuanMnLCBAb25DcnlzdGFsTG9hZCApXG5cblx0XHRsb2FkZXIgPSBuZXcgVEhSRUUuSlNPTkxvYWRlcigpXG5cdFx0bG9hZGVyLmxvYWQoICcuLzNkL2pzb24vd2F0ZXJIRC5qcycsIEBvbldhdGVyTG9hZCApXG5cblx0XHRsb2FkZXIgPSBuZXcgVEhSRUUuSlNPTkxvYWRlcigpXG5cdFx0bG9hZGVyLmxvYWQoICcuLzNkL2pzb24vZmFjZS5qcycsIEBvbkZhY2VMb2FkIClcblxuXHRcdGxvYWRlciA9IG5ldyBUSFJFRS5TY2VuZUxvYWRlcigpXG5cdFx0bG9hZGVyLmxvYWQoICcuLzNkL2pzb24vZXllLmpzJywgQG9uRXllTG9hZCApXG5cblx0XHRsb2FkZXIgPSBuZXcgVEhSRUUuU2NlbmVMb2FkZXIoKVxuXHRcdGxvYWRlci5sb2FkKCAnLi8zZC9qc29uL3doZWVscy5qcycsIEBvbldoZWVsc0xvYWQgKVxuXHRcdHJldHVyblxuXG5cdG9uRGlhbW9uZExvYWQ6KGdlb21ldHJ5KT0+XG5cdFx0QGNvbXB1dGVHZW9tZXRyeShnZW9tZXRyeSlcblx0XHRtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7Y29sb3I6IDB4ZmZmZmZmfSlcblx0XHRAZGlhbW9uZCA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LG1hdGVyaWFsKVxuXHRcdEBjb250YWluZXIuYWRkKEBkaWFtb25kKVxuXHRcdHJldHVyblxuXG5cdG9uRmFjZUxvYWQ6KGdlb21ldHJ5KT0+XG5cdFx0QGNvbXB1dGVHZW9tZXRyeShnZW9tZXRyeSlcblx0XHRtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7Y29sb3I6IDB4ZmZmZmZmLCB3aXJlZnJhbWU6dHJ1ZX0pXG5cdFx0QGZhY2UgPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSxtYXRlcmlhbClcblx0XHRAY29udGFpbmVyLmFkZChAZmFjZSlcblx0XHRyZXR1cm5cblxuXHRvbkV5ZUxvYWQ6KHNjZW5lKT0+XG5cblx0XHRzaGFkZXIgPSBUSFJFRS5TaGFkZXJMaWJbXCJub3JtYWxtYXBcIl1cblx0XHRAdW5pZm9ybXMgPSBUSFJFRS5Vbmlmb3Jtc1V0aWxzLmNsb25lKHNoYWRlci51bmlmb3Jtcylcblx0XHRAdW5pZm9ybXNbXCJ0Tm9ybWFsXCJdLnZhbHVlID0gVEhSRUUuSW1hZ2VVdGlscy5sb2FkVGV4dHVyZShcIi4vM2QvdGV4dHVyZXMvSEQvTk1BUF9leWUucG5nXCIpXG5cdFx0QHVuaWZvcm1zW1widFNwZWN1bGFyXCJdLnZhbHVlID0gVEhSRUUuSW1hZ2VVdGlscy5sb2FkVGV4dHVyZShcIi4vM2QvdGV4dHVyZXMvSEQvRElTUF9leWUucG5nXCIpXG5cdFx0QHVuaWZvcm1zW1widERpZmZ1c2VcIl0udmFsdWUgPSBUSFJFRS5JbWFnZVV0aWxzLmxvYWRUZXh0dXJlKFwiLi8zZC90ZXh0dXJlcy9IRC9URVhUX2V5ZS5wbmdcIilcblx0XHRAdW5pZm9ybXNbXCJlbmFibGVEaWZmdXNlXCJdLnZhbHVlID0gMSBcblx0XHRAdW5pZm9ybXNbXCJlbmFibGVTcGVjdWxhclwiXS52YWx1ZSA9IDEgXG5cdFx0QHVuaWZvcm1zW1widU5vcm1hbFNjYWxlXCJdLnZhbHVlLnggPSAyXG5cdFx0QHVuaWZvcm1zW1widU5vcm1hbFNjYWxlXCJdLnZhbHVlLnkgPSAyXG5cblx0XHRtYXRlcmlhbCA9IG5ldyBUSFJFRS5TaGFkZXJNYXRlcmlhbCh7XG5cdFx0XHRmcmFnbWVudFNoYWRlcjogc2hhZGVyLmZyYWdtZW50U2hhZGVyLFxuXHRcdFx0dmVydGV4U2hhZGVyOiBzaGFkZXIudmVydGV4U2hhZGVyLFxuXHRcdFx0dW5pZm9ybXM6IEB1bmlmb3Jtcyxcblx0XHRcdGxpZ2h0czogdHJ1ZSxcblx0XHRcdHRyYW5zcGFyZW50OiBmYWxzZSxcblx0XHRcdGZvZzogZmFsc2UsXG5cdFx0XHRjb2xvcjogMHhmZmZmZmZcblx0XHR9KVxuXHRcdGZvciBrLCB2IG9mIHNjZW5lLm9iamVjdHNcblx0XHRcdG8gPSB2XG5cdFx0XHRpZihvLm5hbWU9PSdwYXVwaWVyZURvd25fVXYnKSB0aGVuIEBjbG9zZURvd24gPSAgbztcblx0XHRcdGVsc2UgaWYoby5uYW1lPT0ncGF1cGllcmVVcF9VdicpIHRoZW4gQGNsb3NlVXAgPSBvO1xuXHRcdFx0ZWxzZSBAZXllID0gbztcblx0XHRcdEBjb21wdXRlR2VvbWV0cnkoby5nZW9tZXRyeSlcblx0XHRcdG8ubWF0ZXJpYWwgPSBtYXRlcmlhbFxuXHRcdFx0QGNvbnRhaW5lci5hZGQobylcblx0XHRyZXR1cm5cblxuXHRvbkJhc2VMb2FkOihnZW9tZXRyeSk9PlxuXHRcdFxuXHRcdEBjb21wdXRlR2VvbWV0cnkoZ2VvbWV0cnkpXG5cblx0XHRzaGFkZXIgPSBUSFJFRS5TaGFkZXJMaWJbXCJub3JtYWxtYXBcIl1cblx0XHRAdW5pZm9ybXMgPSBUSFJFRS5Vbmlmb3Jtc1V0aWxzLmNsb25lKHNoYWRlci51bmlmb3Jtcylcblx0XHRAdW5pZm9ybXNbXCJ0Tm9ybWFsXCJdLnZhbHVlID0gVEhSRUUuSW1hZ2VVdGlscy5sb2FkVGV4dHVyZShcIi4vM2QvdGV4dHVyZXMvSEQvbm9ybWFsQmFzZTIwNDgucG5nXCIpXG5cdFx0QHVuaWZvcm1zW1widFNwZWN1bGFyXCJdLnZhbHVlID0gVEhSRUUuSW1hZ2VVdGlscy5sb2FkVGV4dHVyZShcIi4vM2QvdGV4dHVyZXMvSEQvc3BlY3VsYXJCYXNlMjA0OC5wbmdcIilcblx0XHRAdW5pZm9ybXNbXCJ0RGlmZnVzZVwiXS52YWx1ZSA9IFRIUkVFLkltYWdlVXRpbHMubG9hZFRleHR1cmUoXCIuLzNkL3RleHR1cmVzL0hEL2Jhc2UxMDI0LnBuZ1wiKVxuXHRcdEB1bmlmb3Jtc1tcImVuYWJsZURpZmZ1c2VcIl0udmFsdWUgPSAxIFxuXHRcdEB1bmlmb3Jtc1tcImVuYWJsZVNwZWN1bGFyXCJdLnZhbHVlID0gMSBcblx0XHRAdW5pZm9ybXNbXCJ1Tm9ybWFsU2NhbGVcIl0udmFsdWUueCA9IDJcblx0XHRAdW5pZm9ybXNbXCJ1Tm9ybWFsU2NhbGVcIl0udmFsdWUueSA9IDJcblxuXHRcdG1hdGVyaWFsID0gbmV3IFRIUkVFLlNoYWRlck1hdGVyaWFsKHtcblx0XHRcdGZyYWdtZW50U2hhZGVyOiBzaGFkZXIuZnJhZ21lbnRTaGFkZXIsXG5cdFx0XHR2ZXJ0ZXhTaGFkZXI6IHNoYWRlci52ZXJ0ZXhTaGFkZXIsXG5cdFx0XHR1bmlmb3JtczogQHVuaWZvcm1zLFxuXHRcdFx0bGlnaHRzOiB0cnVlLFxuXHRcdFx0dHJhbnNwYXJlbnQ6IGZhbHNlLFxuXHRcdFx0Zm9nOiBmYWxzZSxcblx0XHRcdGNvbG9yOiAweGZmZmZmZlxuXHRcdH0pXG5cblx0XHRAbWVzaCA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LG1hdGVyaWFsKVxuXHRcdEBjb250YWluZXIuYWRkKEBtZXNoKVxuXHRcdHJldHVyblxuXG5cdG9uQ3J5c3RhbExvYWQ6KGdlb21ldHJ5KT0+XG5cdFx0XG5cdFx0QGNvbXB1dGVHZW9tZXRyeShnZW9tZXRyeSlcblxuXHRcdEBjcnlzdGFsVW5pZm9ybXMgPSB7XG5cdFx0XHRcInREaWZmdXNlXCI6IHsgdHlwZTogXCJ0XCIsIHZhbHVlOiBUSFJFRS5JbWFnZVV0aWxzLmxvYWRUZXh0dXJlKFwiLi8zZC90ZXh0dXJlcy9IRC9jcnlzdGFsLmpwZ1wiKSB9LFxuXHRcdFx0XCJ1R2xvYmFsVGltZVwiIDogeyB0eXBlOiBcImZcIiwgdmFsdWU6IDAuMCB9XG5cdFx0XHRcInVPcGFjaXR5XCIgOiB7IHR5cGU6IFwiZlwiLCB2YWx1ZTogLjUgfVxuXHRcdH1cblxuXHRcdG1hdGVyaWFsID0gbmV3IFRIUkVFLlNoYWRlck1hdGVyaWFsKHtcblx0XHRcdFxuXHRcdFx0ZnJhZ21lbnRTaGFkZXI6ICBbXG5cdFx0XHRcdFwidW5pZm9ybSBzYW1wbGVyMkQgdERpZmZ1c2U7XCIsXG5cdFx0XHRcdFwidW5pZm9ybSBmbG9hdCB1R2xvYmFsVGltZTtcIixcblx0XHRcdFx0XCJ1bmlmb3JtIGZsb2F0IHVPcGFjaXR5O1wiLFxuXHRcdFx0XHRcInZhcnlpbmcgdmVjMiB2VXY7XCIsXG5cdFx0XHRcdFwidmFyeWluZyB2ZWMzIHZQb3M7XCIsXG5cblx0XHRcdFx0XCJ2b2lkIG1haW4oKSB7XCIsXG5cdFx0XHRcdFx0XCJmbG9hdCByYXRpbyA9IHZQb3MueCAtIC41O1wiLFxuXHRcdFx0XHRcdFwidmVjNCB0ZXh0dXJlID0gdGV4dHVyZTJEKCB0RGlmZnVzZSwgdlV2ICtjb3MocmF0aW8tdUdsb2JhbFRpbWUqLjA0KSouNCk7XCIsXG5cdFx0XHRcdFx0XCJmbG9hdCBjb2xvciA9IGNvcyhyYXRpby11R2xvYmFsVGltZSouMDQpKi41O1wiLFxuXHRcdFx0XHRcdFwiZ2xfRnJhZ0NvbG9yID0gdmVjNCggdGV4dHVyZS5yZ2IgKyBjb2xvciwgdU9wYWNpdHkpO1wiLFxuXHRcdFx0XHRcIn1cIlxuXHRcdFx0XS5qb2luKFwiXFxuXCIpXG5cblx0XHRcdHZlcnRleFNoYWRlcjogW1xuXHRcdFx0XHRcInVuaWZvcm0gZmxvYXQgdUdsb2JhbFRpbWU7XCIsXG5cdFx0XHRcdFwidmFyeWluZyB2ZWMyIHZVdjtcIixcblx0XHRcdFx0XCJ2YXJ5aW5nIHZlYzMgdlBvcztcIixcblxuXHRcdFx0XHRcInZvaWQgbWFpbigpIHtcIixcblx0XHRcdFx0XHRcInZQb3MgPSBwb3NpdGlvbjtcIixcblx0XHRcdFx0XHRcInZVdiA9IHV2O1wiLFxuXHRcdFx0XHRcdFwiZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogbW9kZWxWaWV3TWF0cml4ICogdmVjNCggcG9zaXRpb24sIDEuMCApO1wiLFxuXHRcdFx0XHRcIn1cIlxuXHRcdFx0XHRdLmpvaW4oJ1xcbicpLFxuXG5cdFx0XHR1bmlmb3JtczogQGNyeXN0YWxVbmlmb3Jtcyxcblx0XHRcdGxpZ2h0czogZmFsc2UsXG5cdFx0XHR0cmFuc3BhcmVudDogdHJ1ZSxcblx0XHRcdGZvZzogZmFsc2UsXG5cdFx0XHRjb2xvcjogMHhmZmZmZmZcblx0XHR9KVxuXG5cdFx0QGNyeXN0YWwgPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSxtYXRlcmlhbClcblx0XHRAY29udGFpbmVyLmFkZChAY3J5c3RhbClcblx0XHRyZXR1cm5cblxuXHRvbldhdGVyTG9hZDooZ2VvbWV0cnkpPT5cblx0XHRcblx0XHRAY29tcHV0ZUdlb21ldHJ5KGdlb21ldHJ5KVxuXG5cdFx0QHdhdGVyVW5pZm9ybXMgPSB7XG5cdFx0XHRcInREaWZmdXNlXCI6IHsgdHlwZTogXCJ0XCIsIHZhbHVlOiBUSFJFRS5JbWFnZVV0aWxzLmxvYWRUZXh0dXJlKFwiLi8zZC90ZXh0dXJlcy9IRC93YXRlci5qcGdcIikgfSxcblx0XHRcdFwidUdsb2JhbFRpbWVcIiA6IHsgdHlwZTogXCJmXCIsIHZhbHVlOiAwLjAgfVxuXHRcdFx0XCJhbXBsaXR1ZGVcIjogeyB0eXBlOiBcImZcIiwgdmFsdWU6IC44IH0sXG5cdFx0fVxuXG5cdFx0bWF0ZXJpYWwgPSBuZXcgVEhSRUUuU2hhZGVyTWF0ZXJpYWwoe1xuXHRcdFx0XG5cdFx0XHRmcmFnbWVudFNoYWRlcjogIFtcblx0XHRcdFx0XCJ1bmlmb3JtIHNhbXBsZXIyRCB0RGlmZnVzZTtcIixcblx0XHRcdFx0XCJ1bmlmb3JtIGZsb2F0IHVHbG9iYWxUaW1lO1wiLFxuXG5cdFx0XHRcdFwidmFyeWluZyB2ZWMyIHZVdjtcIixcblx0XHRcdFx0XCJ2YXJ5aW5nIHZlYzMgdlBvcztcIixcblxuXHRcdFx0XHRcInZvaWQgbWFpbigpIHtcIixcblx0XHRcdFx0XHRcImZsb2F0IHJhdGlvID0gLXZQb3MueTtcIixcblx0XHRcdFx0XHRcImZsb2F0IGFscGhhID0gbWluKHZQb3MueS81LjAsLjE1KTtcIixcblx0XHRcdFx0XHRcInZlYzQgdGV4dHVyZSA9IHRleHR1cmUyRCggdERpZmZ1c2UsIHZVdiArY29zKHJhdGlvLXVHbG9iYWxUaW1lKi4wMSkqLjMpO1wiLFxuXHRcdFx0XHRcdFwiZmxvYXQgY29sb3IgPSBjb3MocmF0aW8tdUdsb2JhbFRpbWUqLjA0KSouMzU7XCIsXG5cdFx0XHRcdFx0XCJnbF9GcmFnQ29sb3IgPSB2ZWM0KCB0ZXh0dXJlLnJnYiArIGNvbG9yLCBhbHBoYSk7XCIsXG5cdFx0XHRcdFwifVwiXG5cdFx0XHRdLmpvaW4oXCJcXG5cIilcblxuXHRcdFx0dmVydGV4U2hhZGVyOiBbXG5cdFx0XHRcdFwidW5pZm9ybSBmbG9hdCB1R2xvYmFsVGltZTtcIixcblx0XHRcdFx0XCJ1bmlmb3JtIGZsb2F0IGFtcGxpdHVkZTtcIixcblxuXHRcdFx0XHRcInZhcnlpbmcgdmVjMyB2Tm9ybWFsO1wiLFxuXHRcdFx0XHRcInZhcnlpbmcgdmVjMiB2VXY7XCIsXG5cdFx0XHRcdFwidmFyeWluZyB2ZWMzIHZQb3M7XCIsXG5cblx0XHRcdFx0XCJ2b2lkIG1haW4oKSB7XCIsXG5cdFx0XHRcdFx0XCJ2Tm9ybWFsID0gbm9ybWFsO1wiLFxuXHRcdFx0XHRcdFwidlV2ID0gdXY7XCIsXG5cdFx0XHRcdFx0XCJ2ZWMzIG5ld1Bvc2l0aW9uID0gcG9zaXRpb24gKyBub3JtYWwgKiB2ZWMzKGNvcyh1R2xvYmFsVGltZS83MC4wK3Bvc2l0aW9uLnkqLjQpICogYW1wbGl0dWRlKTtcIixcblx0XHRcdFx0XHRcInZQb3MgPSBuZXdQb3NpdGlvbjtcIixcblx0XHRcdFx0XHRcImdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIG1vZGVsVmlld01hdHJpeCAqIHZlYzQoIG5ld1Bvc2l0aW9uLCAxLjAgKTtcIixcblx0XHRcdFx0XCJ9XCJcblx0XHRcdFx0XS5qb2luKCdcXG4nKSxcblxuXHRcdFx0dW5pZm9ybXM6IEB3YXRlclVuaWZvcm1zLFxuXHRcdFx0bGlnaHRzOiBmYWxzZSxcblx0XHRcdHRyYW5zcGFyZW50OiB0cnVlLFxuXHRcdFx0Zm9nOiBmYWxzZSxcblx0XHRcdGNvbG9yOiAweGZmZmZmZlxuXHRcdH0pXG5cblx0XHRAd2F0ZXIgPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSxtYXRlcmlhbClcblx0XHRAY29udGFpbmVyLmFkZChAd2F0ZXIpXG5cdFx0cmV0dXJuXG5cblx0b25XaGVlbHNMb2FkOihzY2VuZSk9PlxuXHRcdFxuXHRcdHNoYWRlciA9IFRIUkVFLlNoYWRlckxpYltcIm5vcm1hbG1hcFwiXVxuXHRcdEB1bmlmb3JtcyA9IFRIUkVFLlVuaWZvcm1zVXRpbHMuY2xvbmUoc2hhZGVyLnVuaWZvcm1zKVxuXHRcdEB1bmlmb3Jtc1tcInROb3JtYWxcIl0udmFsdWUgPSBUSFJFRS5JbWFnZVV0aWxzLmxvYWRUZXh0dXJlKFwiLi8zZC90ZXh0dXJlcy9IRC8xMzAzMzFfTk1BUF9yb3VlczIwNDgucG5nXCIpXG5cdFx0QHVuaWZvcm1zW1widFNwZWN1bGFyXCJdLnZhbHVlID0gVEhSRUUuSW1hZ2VVdGlscy5sb2FkVGV4dHVyZShcIi4vM2QvdGV4dHVyZXMvSEQvMTMwMzMxX0RJU1Bfcm91ZXMyMDQ4LnBuZ1wiKVxuXHRcdEB1bmlmb3Jtc1tcInREaWZmdXNlXCJdLnZhbHVlID0gVEhSRUUuSW1hZ2VVdGlscy5sb2FkVGV4dHVyZShcIi4vM2QvdGV4dHVyZXMvSEQvMTMwMzMxX1RFWFRfcm91ZXMyMDQ4XzAwMi5wbmdcIilcblx0XHRAdW5pZm9ybXNbXCJlbmFibGVEaWZmdXNlXCJdLnZhbHVlID0gMSBcblx0XHRAdW5pZm9ybXNbXCJlbmFibGVTcGVjdWxhclwiXS52YWx1ZSA9IDEgXG5cdFx0IyBAdW5pZm9ybXNbXCJ1Tm9ybWFsU2NhbGVcIl0udmFsdWUueCA9IDJcblx0XHQjIEB1bmlmb3Jtc1tcInVOb3JtYWxTY2FsZVwiXS52YWx1ZS55ID0gMlxuXG5cdFx0bWF0ZXJpYWwgPSBuZXcgVEhSRUUuU2hhZGVyTWF0ZXJpYWwoe1xuXHRcdFx0ZnJhZ21lbnRTaGFkZXI6IHNoYWRlci5mcmFnbWVudFNoYWRlcixcblx0XHRcdHZlcnRleFNoYWRlcjogc2hhZGVyLnZlcnRleFNoYWRlcixcblx0XHRcdHVuaWZvcm1zOiBAdW5pZm9ybXMsXG5cdFx0XHRsaWdodHM6IHRydWUsXG5cdFx0XHR0cmFuc3BhcmVudDogZmFsc2UsXG5cdFx0XHRmb2c6IGZhbHNlLFxuXHRcdFx0Y29sb3I6IDB4ZmZmZmZmXG5cdFx0fSlcblxuXHRcdEB3aGVlbHNWZXJ0aWNhbCA9IFtdXG5cdFx0QHdoZWVsc0hvcml6b250YWwgPSBbXVxuXG5cdFx0Zm9yIGssIHYgb2Ygc2NlbmUub2JqZWN0c1xuXHRcdFx0byA9IHZcblx0XHRcdEBjb21wdXRlR2VvbWV0cnkoby5nZW9tZXRyeSlcblxuXHRcdFx0IyBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCgpXG5cdFx0XHRvLm1hdGVyaWFsID0gbWF0ZXJpYWxcblx0XHRcdEBjb250YWluZXIuYWRkKG8pXG5cdFx0XHRpZiAoL195Xy9pKS50ZXN0KGspXG5cdFx0XHRcdEB3aGVlbHNWZXJ0aWNhbC5wdXNoKG8pXG5cdFx0XHRlbHNlIFxuXHRcdFx0XHRAd2hlZWxzSG9yaXpvbnRhbC5wdXNoKG8pXG5cdFx0XHRcblx0XHRyZXR1cm5cblxuXHRjb21wdXRlR2VvbWV0cnk6KGdlb21ldHJ5KS0+XG5cdFx0IyBjb21wdXRlIHRoZSBtb2RlbFxuXHRcdGdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpXG5cdFx0Z2VvbWV0cnkuY29tcHV0ZUZhY2VOb3JtYWxzKClcblx0XHRnZW9tZXRyeS5jb21wdXRlVmVydGV4Tm9ybWFscygpXG5cdFx0Z2VvbWV0cnkuY29tcHV0ZVZlcnRleE5vcm1hbHMoKVxuXHRcdGdlb21ldHJ5LmNvbXB1dGVUYW5nZW50cygpXG5cdFx0Z2VvbWV0cnkuY29tcHV0ZU1vcnBoTm9ybWFscygpXG5cdFx0Z2VvbWV0cnkudmVydGljZXNOZWVkVXBkYXRlID0gdHJ1ZVxuXHRcdGdlb21ldHJ5Lm5vcm1hbHNOZWVkVXBkYXRlID0gdHJ1ZVxuXHRcdHJldHVyblxuXG5cblx0dXBkYXRlOihkdCktPlxuXHRcdEB0aW1lICs9IGR0XG5cdFx0QGNvbnRhaW5lci5yb3RhdGlvbi55ICs9IDAuMDA1XG5cdFx0aWYgQHdoZWVsc1ZlcnRpY2FsXG5cdFx0XHRmb3IgdyBpbiBAd2hlZWxzVmVydGljYWxcblx0XHRcdFx0dy5yb3RhdGlvbi55ICs9IDAuMDAzXG5cdFx0XHRmb3IgdyBpbiBAd2hlZWxzSG9yaXpvbnRhbFxuXHRcdFx0XHR3LnJvdGF0aW9uLnggKz0gMC4wMDNcblx0XHRpZiBAY2xvc2VEb3duIFxuXHRcdFx0QGNsb3NlRG93bi5yb3RhdGlvbi54ID0gTWF0aC5hYnMoTWF0aC5zaW4oQHRpbWUvMTAwMCkqLjcpXG5cdFx0XHRAY2xvc2VVcC5yb3RhdGlvbi54ID0gLU1hdGguYWJzKE1hdGguc2luKEB0aW1lLzEwMDApKi43KVxuXG5cdFx0aWYoQGNyeXN0YWxVbmlmb3Jtcylcblx0XHRcdEBjcnlzdGFsVW5pZm9ybXNbXCJ1R2xvYmFsVGltZVwiXS52YWx1ZSArPSBkdC8zMFxuXHRcdGlmKEB3YXRlclVuaWZvcm1zKVxuXHRcdFx0QHdhdGVyVW5pZm9ybXNbXCJ1R2xvYmFsVGltZVwiXS52YWx1ZSArPSBkdC8zMFxuXG5cdFx0XG5cdFx0cmV0dXJuIl19